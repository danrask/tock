Date.now=Date.now||function(){return+new Date},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(t){var i=Array.prototype.slice.call(arguments,1),e=this;return function(){return i.push.apply(i,arguments),e.apply(t,i)}}),function(t,i){"function"==typeof define&&define.amd?define(i):"object"==typeof exports?module.exports=i():t.Tock=i()}(this,function(){function t(){if(this.time+=this.interval,this.countdown&&this.duration_ms-this.time<0)return this.final_time=0,this.go=!1,this.callback(this),clearTimeout(this.timeout),void this.complete(this);this.callback(this);var i=Date.now()-this.start_time-this.time,e=i>0?this.interval-i:this.interval;e>0?this.go&&(this.timeout=setTimeout(t.bind(this),e)):(this.missed_ticks=Math.floor(Math.abs(e)/this.interval),this.time+=this.missed_ticks*this.interval,this.go&&t.call(this))}function i(i){this.duration_ms=i,this.start_time=Date.now(),this.time=0,this.go=!0,t.call(this)}function e(i){this.start_time=i||Date.now(),this.time=0,this.go=!0,t.call(this)}var s=/^\s*(\+|-)?\d+\s*$/,o=/^(\d{1,2}):(\d{2})$/,n=/^(\d{1,2}):(\d{2})(?::|\.)(\d{2,3})$/,a=36e5,h=6e4,r=1e3,u=/^(\d{4})-([0-1]\d)-([0-3]\d)(?:\s|T)(\d{2}):(\d{2}):(\d{2})(?:\.(\d{3})Z?)?$/,c=function(t){return t=t||{},this instanceof c?(c.instances=(c.instances||0)+1,this.go=!1,this.timeout=null,this.missed_ticks=null,this.interval=t.interval||10,this.countdown=t.countdown||!1,this.start_time=0,this.pause_time=0,this.final_time=0,this.duration_ms=0,this.time=0,this.callback=t.callback||function(){},void(this.complete=t.complete||function(){})):new c(t)};return c.prototype.reset=function(){return this.countdown?!1:(this.stop(),this.start_time=0,void(this.time=0))},c.prototype.start=function(t){return this.go?!1:(t=t?this.timeToMS(t):0,this.start_time=t,this.pause_time=0,void(this.countdown?i.call(this,t):e.call(this,Date.now()-t)))},c.prototype.stop=function(){this.pause_time=this.lap(),this.go=!1,clearTimeout(this.timeout),this.final_time=this.countdown?this.duration_ms-this.time:Date.now()-this.start_time},c.prototype.pause=function(){this.go?(this.pause_time=this.lap(),this.stop()):this.pause_time&&(this.countdown?i.call(this,this.pause_time):e.call(this,Date.now()-this.pause_time),this.pause_time=0)},c.prototype.lap=function(){if(this.go){var t;return t=this.countdown?this.duration_ms-(Date.now()-this.start_time):Date.now()-this.start_time}return this.pause_time||this.final_time},c.prototype.msToTime=function(t){var i=this.zeroPad(t%r,3),e=this.zeroPad(Math.floor(t/r%60),2),s=this.zeroPad(Math.floor(t/h%60),2);return s+":"+e+"."+i},c.prototype.zeroPad=function(t,i){for(t=""+t;t.length<i;)t="0"+t;return t},c.prototype.msToTimecode=function(t,i){var e=this.zeroPad(Math.floor(t/r%60),2),s=this.zeroPad(Math.floor(t/h%60),2),o=i?":"+this.zeroPad(Math.floor(t%r),3):"";return hours+":"+s+":"+e+o},c.prototype.timeToMS=function(t){if(s.test(t+""))return t;var i,e,c,m,p=new Date;return o.test(t)?(e=t.split(":"),i=parseInt(e[0],10)*h,i+=parseInt(e[1],10)*r):(c=t.match(n),c?3==c[3].length||parseInt(c[3],10)>59?(i=parseInt(c[1],10)*h,i+=parseInt(c[2],10)*r,i+=parseInt(c[3],10)):(i=parseInt(c[1],10)*a,i+=parseInt(c[2],10)*h,i+=parseInt(c[3],10)*r):u.test(t)?(m=new Date,p=new Date,c=t.match(u),m.setYear(c[1]),m.setMonth(c[2]),m.setDate(c[3]),m.setHours(c[4]),m.setMinutes(c[5]),m.setSeconds(c[6]),void 0!==c[7]&&m.setMilliseconds(c[7]),i=Math.max(0,m.getTime()-p.getTime())):(p=new Date,i=Date.parse(t),i=isNaN(i)?0:Math.max(0,i-p.getTime()))),i},c});
